<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Productivity SPA</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

  <div class="container mx-auto p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">📊 Productivity Teknisi Provisioning SA Singaparna</h1>

    <!-- 🔹 Tabel utama -->
    <div class="overflow-x-auto shadow-md rounded-lg bg-white">
      <table id="mainTable" class="min-w-full border-collapse">
        <thead class="bg-blue-600 text-white">
          <tr id="tableHeader"></tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-200"></tbody>
      </table>
    </div>

    <!-- 🔹 Tempat menampilkan detail ketika angka diklik -->
    <div id="detailSection" class="mt-6 hidden">
      <h2 class="text-xl font-semibold mb-2">📋 Detail Data</h2>
      <div id="detailTableWrapper" class="overflow-x-auto bg-white rounded-lg shadow-md p-4"></div>
    </div>
  </div>

  <!-- ================================================== -->
  <!-- 🔻 BAGIAN JAVASCRIPT -->
  <!-- ================================================== -->
  <script>
  // URL sheet Provi_spa (export CSV)
  const SHEET_PROVI = "https://docs.google.com/spreadsheets/d/e/2PACX-1vXXXXXXXXXXXXXX/pub?gid=123456789&single=true&output=csv";
  // ⚠️ Ganti URL di atas dengan URL CSV sheet kamu

  // Fungsi ambil data CSV + bisa lewati baris awal
  async function fetchCSV(url, skipRows = 0) {
    const res = await fetch(url);
    const text = await res.text();
    const rows = text.trim().split("\n").map(r => r.split(","));
    return rows.slice(skipRows); // lewati baris kosong/judul
  }

  // Fungsi untuk load tabel utama
  async function loadMainTable() {
    const rows = await fetchCSV(SHEET_PROVI, 2); // header di baris ke-3
    const header = rows[0];
    const data = rows.slice(1);

    const headerRow = document.getElementById("tableHeader");
    const body = document.getElementById("tableBody");
    headerRow.innerHTML = "";
    body.innerHTML = "";

    // buat header
    header.forEach(h => {
      const th = document.createElement("th");
      th.className = "px-3 py-2 border text-sm text-center";
      th.textContent = h;
      headerRow.appendChild(th);
    });

    // buat isi tabel
    data.forEach((row, i) => {
      const tr = document.createElement("tr");
      tr.className = "hover:bg-blue-50";

      row.forEach((cell, j) => {
        const td = document.createElement("td");
        td.className = "px-3 py-2 border text-sm text-center";

        // kalau angka dan bukan header "TEKNISI" → buat clickable
        if (j > 0 && cell && !isNaN(cell)) {
          td.innerHTML = `<button class="text-blue-600 hover:underline font-semibold" onclick="showDetail('${header[j]}', '${row[0]}')">${cell}</button>`;
        } else {
          td.textContent = cell;
        }
        tr.appendChild(td);
      });
      body.appendChild(tr);
    });
  }

  // Fungsi tampilkan detail berdasarkan header dan teknisi
  async function showDetail(category, teknisi) {
    // Ambil sheet detail (kalau sheet Provi_spa juga yang dipakai, bisa pakai SHEET_PROVI)
    const rows = await fetchCSV(SHEET_PROVI, 2);
    const header = rows[0];
    const data = rows.slice(1);

    // Contoh filter sederhana (nanti bisa ubah sesuai kebutuhan)
    const filtered = data.filter(r => r[0] === teknisi && r.includes(category));

    const detailSection = document.getElementById("detailSection");
    const wrapper = document.getElementById("detailTableWrapper");

    if (filtered.length === 0) {
      wrapper.innerHTML = `<p class="text-gray-500">Tidak ada data detail untuk ${teknisi} - ${category}</p>`;
      detailSection.classList.remove("hidden");
      return;
    }

    // Buat tabel detail
    let html = `<table class="min-w-full border border-gray-300">
      <thead class="bg-gray-100">
        <tr>${header.map(h => `<th class="px-3 py-2 border text-sm">${h}</th>`).join("")}</tr>
      </thead>
      <tbody>
        ${filtered.map(r => `<tr>${r.map(c => `<td class="px-3 py-1 border text-sm">${c}</td>`).join("")}</tr>`).join("")}
      </tbody>
    </table>`;

    wrapper.innerHTML = html;
    detailSection.classList.remove("hidden");
    window.scrollTo({ top: detailSection.offsetTop, behavior: "smooth" });
  }

  // Jalankan saat halaman dibuka
  loadMainTable();
  </script>

</body>
</html>
