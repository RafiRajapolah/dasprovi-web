<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DAS PROVI ‚Äî Modern Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --primary:#0a58a6; /* modern blue */
      --accent:#007bff;
      --muted:#9aa7bd;
      --shadow: 0 10px 30px rgba(12,40,80,0.06);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg); color:#1f2937;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* layout */
    .app{
      max-width:1200px; margin:20px auto; padding:18px; display:flex; gap:18px; align-items:flex-start;
    }

    /* Sidebar */
    .sidebar{
      width:68px; background:linear-gradient(180deg,var(--primary),var(--accent)); border-radius:12px; padding:12px; color:#fff; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:12px; align-items:center;
    }
    .sidebar .logo{ width:44px; height:44px; border-radius:10px; background:rgba(255,255,255,0.12); display:flex; align-items:center; justify-content:center; font-weight:700 }
    .sidebar a{ color:rgba(255,255,255,0.9); text-decoration:none; font-size:12px }

    /* Main card */
    .main{
      flex:1; background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow);
    }

    .header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:14px }
    .title{ font-size:20px; font-weight:600 }

    .controls{ display:flex; gap:8px; align-items:center }
    .search{ display:flex; align-items:center; gap:8px; background:#f5f7fb; border-radius:10px; padding:6px 8px }
    .search input{ border:0; background:transparent; outline:none; font-size:14px; min-width:220px }
    .btn{ background:var(--primary); color:#fff; border:0; padding:8px 10px; border-radius:8px; cursor:pointer }

    /* Table container */
    .table-wrap{ width:100%; overflow:auto; border-radius:12px }
    table{ width:100%; border-collapse:collapse; min-width:900px }
    thead th{ position:sticky; top:0; background:linear-gradient(180deg,var(--accent),var(--primary)); color:#fff; padding:12px 10px; text-transform:uppercase; font-size:12px }
    tbody td{ padding:12px 10px; border-bottom:1px solid #f0f3f8; font-size:13px; text-align:center }
    tbody tr:hover{ background:#f7fbff }
    td.clickable{ color:var(--accent); cursor:pointer; font-weight:600 }

    /* Detail area */
    #detailContainer{ margin-top:14px; display:none }
    #detailContainer .card{ padding:12px }

    /* overlay loading */
    .overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(12,20,40,0.25); z-index:9999; visibility:hidden; opacity:0; transition:all .18s }
    .overlay.active{ visibility:visible; opacity:1 }
    .spinner{ width:56px; height:56px; border-radius:50%; border:6px solid rgba(255,255,255,0.14); border-top-color:#fff; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .error{ background:#fff4f6; color:#b91c1c; padding:10px; border-radius:8px; margin-bottom:8px; display:none }

    /* responsive */
    @media (max-width:900px){
      .app{ padding:12px; margin:12px }
      table{ min-width:800px }
      .sidebar{ display:none }
      .search input{ min-width:120px }
      thead th, tbody td{ padding:10px }
    }
    @media (max-width:520px){
      table{ min-width:700px }
    }
    table tr td:last-child, table tr th:last-child { display: none; }
</style>
</head>
<body>
  <div class="app">
    <nav class="sidebar" aria-hidden="false">
      <div class="logo">DP</div>
      <a href="#" title="Dashboard">üè†</a>
      <a href="#" title="Provi SPA">üìã</a>
      <a href="#" title="Monet">üí∞</a>
    </nav>

    <main class="main" role="main">
      <div class="header">
        <div>
          <div class="title">Dashboard Provisioning</div>
          <div style="color:var(--muted); font-size:13px; margin-top:4px">Ringkasan & Sisa WO ‚Äî Responsive & Modern</div>
        </div>
        <div class="controls">
          <div class="search" role="search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="#6b7280" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <input id="searchDetail" placeholder="Cari di detail (ketik bebas)..." aria-label="search" />
          </div>
          <button id="refreshBtn" class="btn" title="Refresh sekarang">üîÑ Refresh</button>
        </div>
      </div>

      <div id="errorBox" class="error" role="alert"></div>

      <div class="table-wrap card" aria-live="polite">
        <table id="mainTable" role="table">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="detailContainer" class="card">
        <h3 style="margin-top:0; color:var(--primary)">Detail Data</h3>
        <div style="overflow:auto; max-height:360px">
          <table id="detailTable"><thead></thead><tbody></tbody></table>
        </div>
      </div>
    </main>
  </div>

  <div class="overlay" id="overlay"><div class="spinner" role="status" aria-label="loading"></div></div>

  <script>
  // Configuration ‚Äî public sheets (as provided)
  const SHEET_MAIN = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQlp8lhcVisWxG9C5IwSDAtyJ1J9o5WwJWAiLMLutD7XI-G6VRh4IipiVkJQnFHXtigs9m2JhKaBD9B/pub?gid=1651389267&single=true&output=csv";
  const SHEET_PROVI = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQlp8lhcVisWxG9C5IwSDAtyJ1J9o5WwJWAiLMLutD7XI-G6VRh4IipiVkJQnFHXtigs9m2JhKaBD9B/pub?gid=1451848426&single=true&output=csv";

  // State
  let cacheMain = null; let cacheProvi = null;
  const overlay = document.getElementById('overlay');
  const errorBox = document.getElementById('errorBox');

  function showLoading(){ overlay.classList.add('active'); }
  function hideLoading(){ overlay.classList.remove('active'); }
  function showError(msg){ errorBox.style.display='block'; errorBox.textContent = msg }
  function clearError(){ errorBox.style.display='none'; errorBox.textContent = '' }

  function parseNumber(v){ if (v
