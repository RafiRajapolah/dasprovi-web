<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📊 Productivity Teknisi Provisioning SA Singaparna</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7f8; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #222; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #1a5632; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    td.clickable { color: blue; cursor: pointer; text-decoration: underline; }
    #detail-container { margin-top: 30px; display: none; }
  </style>
</head>
<body>

  <h1>📊 Productivity Teknisi Provisioning SA Singaparna</h1>

  <table id="main-table"></table>
  <div id="detail-container">
    <h2>🔍 Detail Data dari Sheet <b>Provi_spa</b></h2>
    <table id="detail-table"></table>
  </div>

  <script>
    const SHEET_MAIN = "https://docs.google.com/spreadsheets/d/1u7sHZTiuVvw9l1OHethOqi2lGhO-9c09ieN2Rvwye1w/edit?gid=1651389267#gid=1651389267&single=true&output=csv";
    const SHEET_PROVI = "https://docs.google.com/spreadsheets/d/1u7sHZTiuVvw9l1OHethOqi2lGhO-9c09ieN2Rvwye1w/edit?gid=1451848426#gid=1451848426&single=true&output=csv";

    async function fetchCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return text.split('\n').map(r => r.split(','));
    }

    async function renderMainTable() {
      const rows = await fetchCSV(SHEET_MAIN);
      const table = document.getElementById('main-table');
      table.innerHTML = "";

      const thead = document.createElement('thead');
      const tbody = document.createElement('tbody');
      const headerRow = document.createElement('tr');
      rows[2].forEach(h => { // header mulai baris ke-3
        const th = document.createElement('th');
        th.textContent = h.trim();
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      rows.slice(3).forEach((r, i) => {
        if (!r[0]) return;
        const tr = document.createElement('tr');
        r.forEach((cell, j) => {
          const td = document.createElement('td');
          td.textContent = cell.trim();
          if (/^\d+$/.test(cell.trim()) && parseInt(cell.trim()) > 0) {
            td.classList.add("clickable");
            td.onclick = () => showDetail(r[0]);
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
    }

    async function showDetail(technicianName) {
      const rows = await fetchCSV(SHEET_PROVI);
      const table = document.getElementById("detail-table");
      const container = document.getElementById("detail-container");
      container.style.display = "block";

      const headers = rows[0];
      table.innerHTML = "";

      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h.trim();
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      const tbody = document.createElement("tbody");
      rows.slice(1).forEach(r => {
        if (r[4] && r[4].includes(technicianName)) {
          const tr = document.createElement("tr");
          r.forEach(c => {
            const td = document.createElement("td");
            td.textContent = c.trim();
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        }
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    renderMainTable();
  </script>

</body>
</html>
